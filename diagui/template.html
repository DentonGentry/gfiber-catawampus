<!DOCTYPE html>
<html>
  <head>
    <title>Google Fiber Network Box Diagnostics</title>
    <link rel="stylesheet" type="text/css" href="static/style.css">
    <link rel="icon" href="static/favicon.ico">
    <script src="static/jquery-1.10.2.js"></script>
    <script>
      var obj1 = {"checksum": 0};
      function populatefield(element, val) {
        if (val == '' || val == undefined || val == null) {
          populatefield(element, 'n/a');
        }
        else {
          $(element + " .value").append('<li></li>');
          $(element + " .value li").text(val);
        }
      }

      function multivaluefield(element, val) {
        if (jQuery.isEmptyObject(val)){
          populatefield(element, 'n/a');
          return;
        }

        var i = 0;
        for (key in val) {
          $(element + ' .value').append('<li id=' + i + '></li>');
          $(element + ' .value #' + i).text(key + ' ' + val[key]);
          i++;
        }
      }

      function populateOnuFields(data) {
        f = function(field) {
          return (field in data) ? String(data[field]) : "n/a";
        };

        populatefield('#onu_serial', f('onu_serial'));
        populatefield('#onu_wan_connected', f('onu_wan_connected'));
        populatefield('#onu_acs_contacted', f('onu_acs_contacted'));
        populatefield('#onu_uptime', f('onu_uptime'));

        var contact_time = 'n/a';
        if ('onu_acs_contact_time' in data) {
          contact_time = String(new Date(data.onu_acs_contact_time * 1000));
        }
        populatefield('#onu_acs_contact_time', contact_time);
      }

      function getContent() {
          $.getJSON('content.json', obj1 , function(data) {
            $('.value').empty();
            populatefield('#acs', data.acs);
            populatefield('#softversion', data.softversion);
            populatefield('#uptime', data.uptime);
            multivaluefield('#temperature', data.temperature);
            multivaluefield('#wanmac', data.wanmac);
            multivaluefield('#wanip', data.wanip);
            multivaluefield('#lanip', data.lanip);
            populatefield('#subnetmask', data.subnetmask);
            multivaluefield('#lanmac', data.lanmac);
            multivaluefield('#wireddevices', data.wireddevices);
            populatefield('#ssid24', data.ssid24);
            populatefield('#ssid5', data.ssid5);
            multivaluefield('#wpa2', data.wpa2);
            multivaluefield('#wirelesslan', data.wirelesslan);
            multivaluefield('#wirelessdevices', data.wirelessdevices);
            populatefield('#upnp', data.upnp);
            populatefield('#portforwarding', data.portforwarding);
            populatefield('#dmzdevice', data.dmzdevice);
            populatefield('#dyndns', data.dyndns);
            populatefield('#username', data.username);
            populatefield('#domain', data.domain);
            populateOnuFields(data)

            obj1.checksum = data.checksum
          });
        }
      $(document).ready(function() {
        $.ajaxSetup({ cache: false });
        $("#downloadbutton").click(function() {
          newwindow = window.open('', '');
          var toprint = $('#main').html();
          var csslink = newwindow.document.createElement('link');
          csslink.setAttribute('rel', 'stylesheet');
          csslink.setAttribute('type', 'text/css');
          csslink.setAttribute('href', 'static/style.css');
          newwindow.document.writeln(toprint);
          newwindow.document.head.appendChild(csslink);
          newwindow.document.close();
          newwindow.focus();
          newwindow.print();
          newwindow.close();
        });
        getContent();
        setInterval(getContent, 30000);  // refresh data periodically.
      });
    </script>
  </head>
  <body>
  <div id="main">
    <a href="https://fiber.google.com/myfiber"><img src = "static/logo.png" id= "title"></a>
    <div id="connstatusinfo">
      <img src = "static/standingbunny.png" id="img">
      <div id="d2">
        If you'd like to speak to an agent, you may call 1-800-GO-FIBER.
      </div>
    </div>
    <div id="diaginfo">
      <input type = "button" value="Download diagnostic information" id="downloadbutton">
      <form action='/restart' method='post'>
            {% module xsrf_form_html() %}
            <input type = "submit" value="Restart" id="restartbutton">
      </form>
      <div id="d4">
        <p>
         <div id="acs"><span class="name">ACS inform: </span><ul class="value"></ul></div>
        </p>
        <p>
         <div id="softversion"><span class="name">Software Version:</span><ul class="value"></ul></div>
         <div id="uptime"><span class="name">Uptime:</span><ul class="value"></ul></div>
         <div id="temperature"><span class="name">Temperature:</span><ul class="value"></ul></div>
        </p>
        <p>
         <div id="wanmac"><span class="name">WAN MAC:</span><ul class="value"></ul></div>
         <div id="wanip"><span class="name">WAN IP (last):</span><ul class="value"></ul></div>
        </p>
        <p>
         <div id="lanip"><span class="name">LAN IP:</span><ul class="value"></ul></div>
         <div id="subnetmask"><span class="name">Subnet Mask:</span><ul class="value"></ul></div>
        </p>
        <p>
         <div id="lanmac"><span class="name">Wired LAN MAC:</span><ul class="value"></ul></div>
         <div id="wireddevices"><span class="name">Wired devices:</span><ul class="value"></ul></div>
        </p>
        <p>
         <div id="ssid24"><span class="name">2.4 GHz SSID:</span><ul class="value"></ul></div>
         <div id="ssid5"><span class="name">5 GHz SSID:</span><ul class="value"></ul></div>
         <div id="wpa2"><span class="name">WPA2-PSK:</span><ul class="value"></ul></div>
        </p>
        <p>
         <div id="wirelesslan"><span class="name">Wireless LAN MAC:</span><ul class="value"></ul></div>
         <div id="wirelessdevices"><span class="name">Wireless devices:</span><ul class="value"></ul></div>
        </p>
        <p>
         <div id="upnp"><span class="name">UPnP:</span><ul class="value"></ul></div>
         <div id="portforwarding"><span class="name">Port forwarding:</span><ul class="value"></ul></div>
        </p>
        <p>
         <div id="dmzdevice"><span class="name">DMZ device:</span><ul class="value"></ul></div>
        </p>
        <p>
         <div id="dyndns"><span class="name">Dynamic DNS Service:</span><ul class="value"></ul></div>
         <div id="username"><span class="name">Username:</span><ul class="value"></ul></div>
         <div id="domain"><span class="name">Domain/hostname:</span><ul class="value"></ul></div>
        </p>
        <p>
         <div id="fiberjack""><span>Fiberjack:</span></div>
           <div id="onu_serial" class="onu"><span class="name">Serial:</span><ul class="value"></ul></div>
           <div id="onu_wan_connected" class="onu"><span class="name">Connected:</span><ul class="value"></ul></div>
           <div id="onu_acs_contacted" class="onu"><span class="name">ACS Contacted:</span><ul class="value"></ul></div>
           <div id="onu_acs_contact_time" class="onu"><span class="name">ACS Contact Time:</span><ul class="value"></ul></div>
           <div id="onu_uptime" class="onu"><span class="name">Uptime:</span><ul class="value"></ul></div>
         </div>
        </p>
      </div>
    </div>
  </div>
  </body>
</html>
